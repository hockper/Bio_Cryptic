<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Ataque</title>
    <link rel="stylesheet" href="sistema.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=Share+Tech+Mono&display=swap" rel="stylesheet">
</head>
<body>

    <div id="auth-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="panel-title">// AUTENTICAÇÃO DE CANCELAMENTO REQUERIDA //</h2>
            <form id="auth-form">
                <div class="input-group">
                    <label for="cred1">CREDENCIAL ALPHA:</label>
                    <input type="password" id="cred1" required>
                </div>
                <div class="input-group">
                    <label for="cred2">CREDENCIAL BETA:</label>
                    <input type="password" id="cred2" required>
                </div>
                <div class="input-group">
                    <label for="cred3">CREDENCIAL OMEGA:</label>
                    <input type="password" id="cred3" required>
                </div>
                <div id="modal-error-message" class="error-message"></div>
                <div class="modal-buttons">
                    <button type="submit" class="action-button green">AUTENTICAR</button>
                    <button type="button" id="cancel-auth" class="action-button red">CANCELAR</button>
                </div>
            </form>
        </div>
    </div>


    <div class="main-container">
        <div class="left-panel">
            <h2 class="panel-title">> PAINEL DE CONTROLE DE ATAQUE</h2>
            <div class="attack-coords">
                <label>PROTOCOLO:</label>
                <input type="text" id="coord1" value="OFENSIVA-TOTAL" disabled>
                <label>ALVO:</label>
                <input type="text" id="coord2" value="KARTHANIA" disabled>
            </div>
            
            <button id="unlock-button" class="action-button gray">MUDAR COORDENADAS (REQUER AUTENTICAÇÃO)</button>

            <button id="main-action-button" class="action-button big-button red">EFETUAR ATAQUE</button>
        </div>

        <div class="right-panel">
            <h2 class="panel-title">// ACESSO AO SISTEMA</h2>
            <p class="panel-text">
                O protocolo de ataque está ativo e pronto. A execução é iminente. Para alterar os parâmetros, é necessária uma autorização de emergência. Ache as credênciais dentro do sistema e mude local do ataque.
            </p>
            <a href="system.zip" download="system.zip" class="action-button green">
                BAIXAR ARQUIVOS DO SISTEMA
            </a>
        </div>
    </div>

    <script src="sha256.js"></script>

    <script>
        // --- SELEÇÃO DE ELEMENTOS ---
        const unlockButton = document.getElementById('unlock-button');
        const mainActionButton = document.getElementById('main-action-button');
        const authModal = document.getElementById('auth-modal');
        const authForm = document.getElementById('auth-form');
        const cancelAuthButton = document.getElementById('cancel-auth');
        const modalErrorMessage = document.getElementById('modal-error-message');
        const coordInput = document.getElementById('coord2');

        // --- ESTADO INICIAL ---
        let controlsUnlocked = false;

        // --- DEFINIÇÃO DAS CREDENCIAIS E COORDENADAS ---
        // Estas informações devem corresponder ao conteúdo decodificado do seu arquivo .txt
        const correctCred1Hash = 'f370394d51ec4741fd332c744a7d206b3e6f1d96e6bffc8a231d8aa3be5d24e5';
        const correctCred2Hash = '59cd385edfbae715738255b03ba85b46b35634eb118dcaba024840f942590ac1';
        const correctCred3Hash = 'c8218225bc71bb628b41cd2450939788ffb741c0fb6bd3cd85fb4e7cfe73e7b5';
        const winCoord = 'Black Block';


        // --- LÓGICA DO BOTÃO PRINCIPAL DE AÇÃO ---
        mainActionButton.addEventListener('click', async function() {
            // Se os controles foram desbloqueados, verificamos as coordenadas para a vitória
            
            if(controlsUnlocked){
                // Atualiza a interface para refletir o sucesso
                unlockButton.textContent = 'MUDAR COORDENADAS (REQUER AUTENTICAÇÃO)';
                unlockButton.disabled = false;

                coordInput.disabled = true;
                coordInput.value = coordInput.value.toLowerCase().trim();
                

                
                
                mainActionButton.textContent = 'EFETUAR ATAQUE';
                mainActionButton.classList.remove('green');
                mainActionButton.classList.add('red');

                controlsUnlocked = false;
            }else{
                if(coordInput.value == winCoord){
                    window.location.href = 'sucesso.html';
                }else{
                    window.location.href = 'falha.html';
                }
            }

            


        });

        // --- LÓGICA DO MODAL DE AUTENTICAÇÃO ---
        unlockButton.addEventListener('click', () => {
            authModal.style.display = 'flex';
        });

        cancelAuthButton.addEventListener('click', () => {
            authModal.style.display = 'none';
        });

        authForm.addEventListener('submit', async function(event) {
            event.preventDefault();
            
            const cred1 = document.getElementById('cred1').value;
            const cred2 = document.getElementById('cred2').value;
            const cred3 = document.getElementById('cred3').value;
            const cred1Hash = await sha256(cred1);
            const cred2Hash = await sha256(cred2);
            const cred3Hash = await sha256(cred3);


            if (cred1Hash === correctCred1Hash && cred2Hash === correctCred2Hash && cred3Hash === correctCred3Hash) {
                // Sucesso na autenticação
                authModal.style.display = 'none';
                controlsUnlocked = true; // Muda o estado do controle

                // Atualiza a interface para refletir o sucesso
                unlockButton.textContent = 'AUTENTICAÇÃO ACEITA';
                unlockButton.disabled = true;

                coordInput.disabled = false;
                coordInput.value = '';
                
                mainActionButton.textContent = 'CONFIRMAR CANCELAMENTO';
                mainActionButton.classList.remove('red');
                mainActionButton.classList.add('green');
            } else {
                // Erro na autenticação
                modalErrorMessage.textContent = '[[ AUTENTICAÇÃO FALHOU ]]';
                authForm.reset();
            }
        });
    </script>
</body>
</html>